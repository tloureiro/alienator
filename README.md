Modified version of code provided by: J. Burt; Strap, Jock et al
